import { describe, it, expect } from 'vitest';\nimport { botFlowService } from '../src/services/bot-flow.service.js';\nimport { EstadoBot } from '../src/models/schemas.js';\n\ndescribe('Bot Flow Service', () => {\n  describe('Menu Principal', () => {\n    it('deve retornar menu principal com 5 opções', () => {\n      const menu = botFlowService.getMenuPrincipal();\n\n      expect(menu).toBeTruthy();\n      expect(menu.opcoes).toHaveLength(5);\n      expect(menu.proximoEstado).toBe(EstadoBot.MENU_PRINCIPAL);\n    });\n\n    it('deve conter opção de Totalizador de Vendas', () => {\n      const menu = botFlowService.getMenuPrincipal();\n      const opcao = menu.opcoes.find((o) => o.id === '1');\n\n      expect(opcao).toBeTruthy();\n      expect(opcao?.texto).toContain('Totalizador');\n    });\n  });\n\n  describe('Menu de Data', () => {\n    it('deve retornar menu de data com 6 opções', () => {\n      const menu = botFlowService.getMenuData();\n\n      expect(menu).toBeTruthy();\n      expect(menu.opcoes).toHaveLength(6);\n      expect(menu.proximoEstado).toBe(EstadoBot.AGUARDANDO_DATA);\n    });\n\n    it('deve conter opção de Hoje', () => {\n      const menu = botFlowService.getMenuData();\n      const opcao = menu.opcoes.find((o) => o.id === 'hoje');\n\n      expect(opcao).toBeTruthy();\n      expect(opcao?.texto).toBe('Hoje');\n    });\n  });\n\n  describe('Menu de Equipes', () => {\n    it('deve retornar menu de equipes com 6 opções', () => {\n      const menu = botFlowService.getMenuEquipes();\n\n      expect(menu).toBeTruthy();\n      expect(menu.opcoes).toHaveLength(6);\n      expect(menu.proximoEstado).toBe(EstadoBot.AGUARDANDO_EQUIPE);\n    });\n\n    it('deve conter todas as 5 equipes', () => {\n      const menu = botFlowService.getMenuEquipes();\n      const equipes = ['Loja', 'Food Service', 'Varejo', 'Redes', 'Telemarketing'];\n\n      equipes.forEach((equipe) => {\n        const opcao = menu.opcoes.find((o) => o.texto.includes(equipe));\n        expect(opcao).toBeTruthy();\n      });\n    });\n  });\n\n  describe('Processamento de Respostas', () => {\n    it('deve processar seleção no menu principal', async () => {\n      const contexto = {};\n      const resultado = await botFlowService.processarResposta(\n        '1',\n        EstadoBot.MENU_PRINCIPAL,\n        contexto\n      );\n\n      expect(resultado).toBeTruthy();\n      expect(resultado.proximoEstado).toBe(EstadoBot.AGUARDANDO_DATA);\n      expect(resultado.contextoAtualizado.opcaoMenuPrincipal).toBe('1');\n    });\n\n    it('deve encerrar quando usuário seleciona opção 5', async () => {\n      const contexto = {};\n      const resultado = await botFlowService.processarResposta(\n        '5',\n        EstadoBot.MENU_PRINCIPAL,\n        contexto\n      );\n\n      expect(resultado.proximoEstado).toBe(EstadoBot.ENCERRADO);\n    });\n\n    it('deve voltar ao menu principal quando usuário seleciona voltar', async () => {\n      const contexto = { opcaoMenuPrincipal: '1' };\n      const resultado = await botFlowService.processarResposta(\n        'voltar',\n        EstadoBot.AGUARDANDO_DATA,\n        contexto\n      );\n\n      expect(resultado.proximoEstado).toBe(EstadoBot.MENU_PRINCIPAL);\n    });\n\n    it('deve processar seleção de data e atualizar contexto', async () => {\n      const contexto = { opcaoMenuPrincipal: '1' };\n      const resultado = await botFlowService.processarResposta(\n        'hoje',\n        EstadoBot.AGUARDANDO_DATA,\n        contexto\n      );\n\n      expect(resultado.contextoAtualizado.dataInicio).toBeTruthy();\n      expect(resultado.contextoAtualizado.dataFim).toBeTruthy();\n    });\n\n    it('deve processar seleção de equipe', async () => {\n      const contexto = { opcaoMenuPrincipal: '1', dataInicio: '2025-01-01', dataFim: '2025-01-31' };\n      const resultado = await botFlowService.processarResposta(\n        '1',\n        EstadoBot.AGUARDANDO_EQUIPE,\n        contexto\n      );\n\n      expect(resultado.contextoAtualizado.equipeId).toBe(1);\n      expect(resultado.proximoEstado).toBe(EstadoBot.PROCESSANDO);\n    });\n  });\n});\n
