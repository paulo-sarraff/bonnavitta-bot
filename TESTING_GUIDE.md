# üß™ Guia de Testes - Chatbot BonnaVitta\n\n**Tempo estimado:** 15-20 minutos\n\n---\n\n## üìã Ferramentas Necess√°rias\n\n### Op√ß√£o 1: cURL (Linha de Comando)\n\n```bash\n# Verificar se est√° instalado\ncurl --version\n```\n\n### Op√ß√£o 2: Postman (GUI)\n\n- Download: https://www.postman.com/downloads/\n- Importar collection: `postman_collection.json`\n\n### Op√ß√£o 3: Insomnia (GUI)\n\n- Download: https://insomnia.rest/download\n- Mais leve que Postman\n\n---\n\n## üöÄ Testes R√°pidos\n\n### 1. Health Check\n\n```bash\ncurl http://localhost:8000/health\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"status\": \"ok\",\n  \"timestamp\": \"2025-01-28T10:30:45.123Z\",\n  \"uptime\": 123.456\n}\n```\n\n### 2. Informa√ß√µes da API\n\n```bash\ncurl http://localhost:8000/\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"nome\": \"Chatbot BonnaVitta\",\n  \"versao\": \"1.0.0\",\n  \"descricao\": \"Bot inteligente para consulta de dados de vendas\",\n  \"endpoints\": {\n    \"autenticacao\": \"/api/auth/login\",\n    \"bot\": \"/api/bot/message\",\n    \"webhooks\": {\n      \"telegram\": \"/api/webhook/telegram\",\n      \"whatsapp\": \"/api/webhook/whatsapp\"\n    },\n    \"saude\": \"/health\"\n  }\n}\n```\n\n---\n\n## üîê Testes de Autentica√ß√£o\n\n### 1. Login (Obter Token)\n\n```bash\ncurl -X POST http://localhost:8000/api/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"cpf\": \"12345678901\",\n    \"telefone\": \"11999999999\",\n    \"canal\": \"telegram\",\n    \"chatId\": \"123456789\"\n  }'\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": true,\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"usuario\": {\n    \"id\": 1,\n    \"cpf\": \"12345678901\",\n    \"nome\": \"Jo√£o Silva\",\n    \"email\": \"joao@example.com\",\n    \"telefone\": \"11999999999\",\n    \"equipeId\": 1,\n    \"nomeEquipe\": \"Loja\",\n    \"role\": \"vendedor\",\n    \"ativo\": true\n  },\n  \"sessaoId\": 1,\n  \"mensagem\": \"Bem-vindo, Jo√£o Silva!\"\n}\n```\n\n**Salve o token para os pr√≥ximos testes:**\n\n```bash\n# Linux/Mac\nexport TOKEN=\"seu-token-aqui\"\n\n# Windows (PowerShell)\n$env:TOKEN=\"seu-token-aqui\"\n```\n\n### 2. Validar Token\n\n```bash\ncurl http://localhost:8000/api/auth/validate \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": true,\n  \"usuario\": {\n    \"id\": 1,\n    \"cpf\": \"12345678901\",\n    \"nome\": \"Jo√£o Silva\",\n    \"equipeId\": 1,\n    \"role\": \"vendedor\"\n  }\n}\n```\n\n### 3. Teste com Token Inv√°lido\n\n```bash\ncurl http://localhost:8000/api/auth/validate \\\n  -H \"Authorization: Bearer token-invalido\"\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": false,\n  \"mensagem\": \"Token inv√°lido ou expirado\"\n}\n```\n\n---\n\n## ü§ñ Testes do Bot\n\n### 1. Obter Menu Principal\n\n```bash\ncurl http://localhost:8000/api/bot/menu \\\n  -H \"Authorization: Bearer $TOKEN\"\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": true,\n  \"menu\": {\n    \"resposta\": \"üè™ *Bem-vindo ao Chatbot BonnaVitta*\\n\\nO que deseja consultar?\\n\",\n    \"opcoes\": [\n      {\n        \"id\": \"1\",\n        \"texto\": \"Totalizador de Vendas\",\n        \"emoji\": \"üìä\"\n      },\n      {\n        \"id\": \"2\",\n        \"texto\": \"Vendas por Vendedor\",\n        \"emoji\": \"üë•\"\n      },\n      {\n        \"id\": \"3\",\n        \"texto\": \"Ranking de Produtos\",\n        \"emoji\": \"üèÜ\"\n      },\n      {\n        \"id\": \"4\",\n        \"texto\": \"Performance por Equipe\",\n        \"emoji\": \"üìà\"\n      },\n      {\n        \"id\": \"5\",\n        \"texto\": \"Sair\",\n        \"emoji\": \"üëã\"\n      }\n    ],\n    \"proximoEstado\": \"menu_principal\"\n  }\n}\n```\n\n### 2. Processar Mensagem (Selecionar Op√ß√£o 1)\n\n```bash\ncurl -X POST http://localhost:8000/api/bot/message \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -d '{\n    \"usuarioId\": 1,\n    \"canal\": \"telegram\",\n    \"chatId\": \"123456789\",\n    \"mensagem\": \"1\"\n  }'\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": true,\n  \"resposta\": \"üìÖ *Qual per√≠odo deseja consultar?*\\n\",\n  \"opcoes\": [\n    {\n      \"id\": \"hoje\",\n      \"texto\": \"Hoje\",\n      \"emoji\": \"üìç\"\n    },\n    {\n      \"id\": \"ontem\",\n      \"texto\": \"Ontem\",\n      \"emoji\": \"‚èÆÔ∏è\"\n    },\n    {\n      \"id\": \"7dias\",\n      \"texto\": \"√öltimos 7 dias\",\n      \"emoji\": \"üìÜ\"\n    },\n    {\n      \"id\": \"mes\",\n      \"texto\": \"Este m√™s\",\n      \"emoji\": \"üìÖ\"\n    },\n    {\n      \"id\": \"mespassado\",\n      \"texto\": \"M√™s anterior\",\n      \"emoji\": \"‚è™\"\n    },\n    {\n      \"id\": \"voltar\",\n      \"texto\": \"Voltar\",\n      \"emoji\": \"üîô\"\n    }\n  ],\n  \"proximoEstado\": \"aguardando_data\"\n}\n```\n\n### 3. Selecionar Data (Hoje)\n\n```bash\ncurl -X POST http://localhost:8000/api/bot/message \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -d '{\n    \"usuarioId\": 1,\n    \"canal\": \"telegram\",\n    \"chatId\": \"123456789\",\n    \"mensagem\": \"hoje\"\n  }'\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": true,\n  \"resposta\": \"üìä *Totalizador de Vendas*\\n\\nDeseja ver:\\n\",\n  \"opcoes\": [\n    {\n      \"id\": \"total\",\n      \"texto\": \"Vendas totais (todas as equipes)\",\n      \"emoji\": \"üìä\"\n    },\n    {\n      \"id\": \"equipe\",\n      \"texto\": \"Equipe espec√≠fica\",\n      \"emoji\": \"üë•\"\n    },\n    {\n      \"id\": \"voltar\",\n      \"texto\": \"Voltar\",\n      \"emoji\": \"üîô\"\n    }\n  ],\n  \"proximoEstado\": \"aguardando_tipo_consulta\"\n}\n```\n\n### 4. Selecionar Vendas Totais\n\n```bash\ncurl -X POST http://localhost:8000/api/bot/message \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -d '{\n    \"usuarioId\": 1,\n    \"canal\": \"telegram\",\n    \"chatId\": \"123456789\",\n    \"mensagem\": \"total\"\n  }'\n```\n\n**Resposta esperada:**\n\n```json\n{\n  \"success\": true,\n  \"resposta\": \"üìä *Vendas por Equipe*\\n\\n*Loja*\\n  üí∞ Valor Total: R$ 1.250,00\\n  üé´ Ticket M√©dio: R$ 250,00\\n  üìà Transa√ß√µes: 5\\n  üë• Vendedores: 2\\n\\n*Food Service*\\n  üí∞ Valor Total: R$ 890,50\\n  üé´ Ticket M√©dio: R$ 178,10\\n  üìà Transa√ß√µes: 5\\n  üë• Vendedores: 1\\n\\n*Varejo*\\n  üí∞ Valor Total: R$ 2.150,00\\n  üé´ Ticket M√©dio: R$ 430,00\\n  üìà Transa√ß√µes: 5\\n  üë• Vendedores: 2\\n\\n*Redes*\\n  üí∞ Valor Total: R$ 1.560,75\\n  üé´ Ticket M√©dio: R$ 312,15\\n  üìà Transa√ß√µes: 5\\n  üë• Vendedores: 1\\n\\n*Telemarketing*\\n  üí∞ Valor Total: R$ 3.200,00\\n  üé´ Ticket M√©dio: R$ 640,00\\n  üìà Transa√ß√µes: 5\\n  üë• Vendedores: 2\\n\\n*TOTAL GERAL: R$ 9.051,25*\\n\\nDeseja ver detalhes de alguma equipe espec√≠fica?\",\n  \"grafico\": \"/charts/vendas-equipe-1234567890.png\",\n  \"proximoEstado\": \"exibindo_resultado\"\n}\n```\n\n---\n\n## üìä Testes de Dados\n\n### 1. Consultar Vendas por Per√≠odo\n\n```bash\n# Vendas de hoje\nSELECT * FROM v_VendasPorEquipe WHERE DataVenda = CAST(GETDATE() AS DATE)\n\n# Vendas do m√™s\nSELECT * FROM v_VendasPorEquipe \nWHERE MONTH(DataVenda) = MONTH(GETDATE())\nAND YEAR(DataVenda) = YEAR(GETDATE())\n```\n\n### 2. Verificar Usu√°rios\n\n```bash\nSELECT * FROM Usuarios\nWHERE Ativo = 1\n```\n\n### 3. Verificar Sess√µes Ativas\n\n```bash\nSELECT * FROM SessoesBot\nWHERE DataCriacao > DATEADD(HOUR, -24, GETDATE())\n```\n\n---\n\n## üß™ Testes Unit√°rios\n\n### Executar Todos\n\n```bash\nnpm test\n```\n\n### Executar Espec√≠fico\n\n```bash\n# Testes de autentica√ß√£o\nnpm test auth.test.ts\n\n# Testes de fluxo\nnpm test bot-flow.test.ts\n\n# Testes de formata√ß√£o\nnpm test formatter.test.ts\n```\n\n### Com Coverage\n\n```bash\nnpm run test:coverage\n```\n\n---\n\n## üìù Postman Collection\n\nCrie um arquivo `postman_collection.json`:\n\n```json\n{\n  \"info\": {\n    \"name\": \"Chatbot BonnaVitta\",\n    \"schema\": \"https://schema.getpostman.com/json/collection/v2.1.0/collection.json\"\n  },\n  \"item\": [\n    {\n      \"name\": \"Health Check\",\n      \"request\": {\n        \"method\": \"GET\",\n        \"url\": \"http://localhost:8000/health\"\n      }\n    },\n    {\n      \"name\": \"Login\",\n      \"request\": {\n        \"method\": \"POST\",\n        \"header\": [{\"key\": \"Content-Type\", \"value\": \"application/json\"}],\n        \"url\": \"http://localhost:8000/api/auth/login\",\n        \"body\": {\n          \"mode\": \"raw\",\n          \"raw\": \"{\\n  \\\"cpf\\\": \\\"12345678901\\\",\\n  \\\"telefone\\\": \\\"11999999999\\\",\\n  \\\"canal\\\": \\\"telegram\\\",\\n  \\\"chatId\\\": \\\"123456789\\\"\\n}\"\n        }\n      }\n    }\n  ]\n}\n```\n\nImporte em Postman: File ‚Üí Import ‚Üí Selecione o arquivo\n\n---\n\n## ‚úÖ Checklist de Testes\n\n- [ ] Health check retorna status ok\n- [ ] API info retorna endpoints corretos\n- [ ] Login com credenciais v√°lidas retorna token\n- [ ] Login com credenciais inv√°lidas retorna erro\n- [ ] Token v√°lido passa na valida√ß√£o\n- [ ] Token inv√°lido falha na valida√ß√£o\n- [ ] Menu principal tem 5 op√ß√µes\n- [ ] Fluxo de data funciona\n- [ ] Fluxo de equipe funciona\n- [ ] Consulta de vendas retorna dados\n- [ ] Gr√°fico √© gerado\n- [ ] Testes unit√°rios passam\n- [ ] Logs s√£o criados\n- [ ] Banco de dados conecta\n\n---\n\n## üêõ Erros Comuns\n\n### \"401 Unauthorized\"\n\n```\nProblema: Token n√£o fornecido ou inv√°lido\nSolu√ß√£o: Fa√ßa login primeiro e use o token retornado\n```\n\n### \"404 Not Found\"\n\n```\nProblema: Rota n√£o existe\nSolu√ß√£o: Verifique a URL e o m√©todo HTTP\n```\n\n### \"500 Internal Server Error\"\n\n```\nProblema: Erro no servidor\nSolu√ß√£o: Verifique os logs em logs/error.log\n```\n\n### \"Connection refused\"\n\n```\nProblema: API n√£o est√° rodando\nSolu√ß√£o: Execute npm run dev\n```\n\n---\n\n**Tudo testado e funcionando! üéâ**\n
